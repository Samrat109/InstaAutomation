<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Automation Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --spotify-green: #1DB954;
            --spotify-black: #191414;
            --spotify-dark-gray: #282828;
            --spotify-light-gray: #B3B3B3;
            --royal-blue: #4169E1;
            --royal-purple: #7851A9;
            --royal-gold: #D4AF37;
        }
        
        body {
            background-color: var(--spotify-black);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
        }
        .container {
            max-width: 500px;
            margin-top: 50px;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            background-color: var(--spotify-dark-gray);
            border: none;
        }
        .card-header {
            background: linear-gradient(135deg, var(--royal-blue), var(--royal-purple));
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 20px;
            border-bottom: 2px solid var(--royal-gold);
        }
        .form-control {
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            background-color: #333;
            border: 1px solid #444;
            color: white;
        }
        .form-control:focus {
            background-color: #444;
            border-color: var(--spotify-green);
            color: white;
            box-shadow: 0 0 0 0.25rem rgba(29, 185, 84, 0.25);
        }
        .form-control::placeholder {
            color: var(--spotify-light-gray);
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--spotify-green), var(--royal-blue));
            border: none;
            border-radius: 10px;
            padding: 12px;
            width: 100%;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--royal-blue), var(--spotify-green));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        #status {
            margin-top: 20px;
            display: none;
            border-radius: 10px;
        }
        .spinner-border {
            width: 1.5rem;
            height: 1.5rem;
            margin-right: 10px;
            color: var(--spotify-green);
        }
        .progress {
            height: 10px;
            margin-top: 20px;
            display: none;
            background-color: #333;
            border-radius: 5px;
        }
        .progress-bar {
            background: linear-gradient(90deg, var(--spotify-green), var(--royal-blue));
        }
        .alert {
            border-radius: 10px;
            border: none;
        }
        .alert-success {
            background-color: rgba(29, 185, 84, 0.2);
            color: var(--spotify-green);
            border-left: 4px solid var(--spotify-green);
        }
        .alert-warning {
            background-color: rgba(212, 175, 55, 0.2);
            color: var(--royal-gold);
            border-left: 4px solid var(--royal-gold);
        }
        .alert-danger {
            background-color: rgba(220, 53, 69, 0.2);
            color: #ff6b6b;
            border-left: 4px solid #ff6b6b;
        }
        .alert-info {
            background-color: rgba(65, 105, 225, 0.2);
            color: var(--royal-blue);
            border-left: 4px solid var(--royal-blue);
        }
        .card-body {
            padding: 30px;
        }
        h3 {
            font-weight: bold;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        /* Music Player Styles */
        .music-player-popup {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            background-color: var(--spotify-dark-gray);
            border-radius: 15px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .music-player-header {
            background: linear-gradient(135deg, var(--royal-blue), var(--royal-purple));
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--royal-gold);
        }
        
        .music-player-title {
            font-weight: bold;
            font-size: 16px;
            color: white;
        }
        
        .music-player-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }
        
        .music-player-body {
            padding: 20px;
        }
        
        .music-player-artwork {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, var(--spotify-green), var(--royal-blue));
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .music-player-artwork i {
            font-size: 60px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .music-player-info {
            margin-bottom: 15px;
        }
        
        .music-player-song {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .music-player-artist {
            color: var(--spotify-light-gray);
            font-size: 14px;
        }
        
        .music-player-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .music-player-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .music-player-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .music-player-btn.play-pause {
            background-color: var(--spotify-green);
            font-size: 18px;
        }
        
        .music-player-btn.play-pause:hover {
            transform: scale(1.1);
        }
        
        .music-player-progress {
            width: 100%;
            height: 5px;
            background-color: #333;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer;
            position: relative;
        }
        
        .music-player-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--spotify-green), var(--royal-blue));
            border-radius: 5px;
            width: 0%;
            transition: width 0.1s linear;
        }
        
        .music-player-time {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--spotify-light-gray);
        }
        
        .music-player-volume {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .music-player-volume i {
            color: var(--spotify-light-gray);
            margin-right: 10px;
            font-size: 16px;
        }
        
        .music-player-volume-slider {
            flex: 1;
            height: 5px;
            background-color: #333;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
        }
        
        .music-player-volume-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--spotify-green), var(--royal-blue));
            border-radius: 5px;
            width: 70%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header text-center">
                <h3>Instagram Automation Tool</h3>
            </div>
            <div class="card-body">
                <form id="automationForm" method="POST" action="/start">
                    <div class="mb-3">
                        <input type="text" class="form-control" name="your_username" placeholder="Your Instagram Username" required>
                    </div>
                    <div class="mb-3">
                        <input type="password" class="form-control" name="your_password" placeholder="Your Instagram Password" required>
                    </div>
                    <div class="mb-3">
                        <input type="text" class="form-control" name="target_username" placeholder="Target Instagram Username" required>
                    </div>
                    <button type="submit" class="btn btn-primary" id="submitBtn">Start Automation</button>
                </form>
                <div class="progress">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                </div>
                <div id="status" class="alert" role="alert"></div>
            </div>
        </div>
    </div>

    <!-- Music Player Popup -->
    <div class="music-player-popup" id="musicPlayer">
        <div class="music-player-header">
            <div class="music-player-title">Now Playing</div>
            <button class="music-player-close" id="closeMusicPlayer">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="music-player-body">
            <div class="music-player-artwork">
                <i class="fas fa-music"></i>
            </div>
            <div class="music-player-info">
                <div class="music-player-song">Automation Music</div>
                <div class="music-player-artist">Background Track</div>
            </div>
            <div class="music-player-progress">
                <div class="music-player-progress-bar" id="progressBar"></div>
            </div>
            <div class="music-player-time">
                <span id="currentTime">0:00</span>
                <span id="duration">0:00</span>
            </div>
            <div class="music-player-controls">
                <button class="music-player-btn" id="prevBtn">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button class="music-player-btn play-pause" id="playPauseBtn">
                    <i class="fas fa-play"></i>
                </button>
                <button class="music-player-btn" id="nextBtn">
                    <i class="fas fa-step-forward"></i>
                </button>
            </div>
            <div class="music-player-volume">
                <i class="fas fa-volume-up"></i>
                <div class="music-player-volume-slider">
                    <div class="music-player-volume-bar" id="volumeBar"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Create a new audio element with the correct path
        let audio = null;
        let isPlaying = false;
        let isAutomationRunning = false;
        let audioLoopInterval = null;
        
        // Function to initialize audio
        function initAudio() {
            // Create a new audio element
            audio = new Audio();
            
            // Set the source to the static folder path
            audio.src = '/static/WhatsApp Audio 2025-04-30 at 9.09.29 PM.mpeg';
            
            // Set volume
            audio.volume = 0.7;
            
            // Set loop to true so it plays continuously
            audio.loop = true;
            
            // Add event listeners
            audio.addEventListener('loadedmetadata', () => {
                durationEl.textContent = formatTime(audio.duration);
                console.log('Audio metadata loaded successfully');
            });
            
            audio.addEventListener('timeupdate', updateProgress);
            
            audio.addEventListener('error', (e) => {
                console.error('Error loading audio:', e);
                console.error('Audio error code:', audio.error.code);
                console.error('Audio error message:', audio.error.message);
                
                // Try alternative path format
                const alternativePath = '/static/WhatsApp Audio 2025-04-30 at 9.09.29 PM.mpeg';
                console.log('Trying alternative path:', alternativePath);
                audio.src = alternativePath;
                audio.load();
            });
            
            // Load the audio
            audio.load();
            console.log('Audio loaded with path:', audio.src);
        }
        
        // Music player elements
        const musicPlayer = document.getElementById('musicPlayer');
        const closeMusicPlayer = document.getElementById('closeMusicPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const progressBar = document.getElementById('progressBar');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');
        const volumeBar = document.getElementById('volumeBar');
        
        // Format time
        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        }
        
        // Update progress bar
        function updateProgress() {
            if (!audio || isNaN(audio.duration)) return;
            const percent = (audio.currentTime / audio.duration) * 100;
            progressBar.style.width = `${percent}%`;
            currentTimeEl.textContent = formatTime(audio.currentTime);
        }
        
        // Function to ensure audio keeps playing
        function ensureAudioPlaying() {
            if (isAutomationRunning && audio && audio.paused) {
                console.log('Restarting audio playback...');
                audio.play().catch(error => {
                    console.error('Error restarting audio:', error);
                });
            }
        }
        
        // Play/pause toggle
        function togglePlay() {
            if (!audio) {
                initAudio();
            }
            
            if (isPlaying) {
                audio.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                isPlaying = false;
                
                // Clear the interval if we're manually pausing
                if (audioLoopInterval) {
                    clearInterval(audioLoopInterval);
                    audioLoopInterval = null;
                }
            } else {
                // Create a user interaction context
                const playAudio = () => {
                    console.log('Attempting to play audio...');
                    audio.play()
                        .then(() => {
                            console.log('Audio playing successfully');
                            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                            isPlaying = true;
                            
                            // If automation is running, set up an interval to ensure it keeps playing
                            if (isAutomationRunning) {
                                if (!audioLoopInterval) {
                                    audioLoopInterval = setInterval(ensureAudioPlaying, 5000); // Check every 5 seconds
                                }
                            }
                            
                            // Remove the click listener after successful playback
                            document.removeEventListener('click', playAudio);
                        })
                        .catch(error => {
                            console.error('Playback error:', error);
                            // Try with a direct path
                            const directPath = '/static/WhatsApp Audio 2025-04-30 at 9.09.29 PM.mpeg';
                            console.log('Trying direct path:', directPath);
                            audio.src = directPath;
                            audio.load();
                            
                            // Add a click listener to the play button specifically
                            playPauseBtn.addEventListener('click', () => {
                                audio.play()
                                    .then(() => {
                                        console.log('Audio playing with direct path');
                                        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                                        isPlaying = true;
                                        
                                        // If automation is running, set up an interval to ensure it keeps playing
                                        if (isAutomationRunning) {
                                            if (!audioLoopInterval) {
                                                audioLoopInterval = setInterval(ensureAudioPlaying, 5000); // Check every 5 seconds
                                            }
                                        }
                                    })
                                    .catch(err => {
                                        console.error('Direct path playback failed:', err);
                                        alert('Could not play the audio file. Please check if the file exists in the static folder.');
                                    });
                            }, { once: true });
                        });
                };
                
                // Try to play immediately
                playAudio();
            }
        }
        
        // Event listeners for music player
        playPauseBtn.addEventListener('click', togglePlay);
        
        closeMusicPlayer.addEventListener('click', () => {
            musicPlayer.style.display = 'none';
            if (audio) {
                audio.pause();
                isPlaying = false;
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                
                // Clear the interval when closing the player
                if (audioLoopInterval) {
                    clearInterval(audioLoopInterval);
                    audioLoopInterval = null;
                }
            }
        });
        
        // Initialize audio on page load
        document.addEventListener('DOMContentLoaded', initAudio);
        
        // Form submission
        document.getElementById('automationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form elements
            const statusDiv = document.getElementById('status');
            const submitBtn = document.getElementById('submitBtn');
            const progressBar = document.querySelector('.progress');
            
            // Disable form and show progress
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>Processing...';
            progressBar.style.display = 'block';
            
            // Show status
            statusDiv.style.display = 'block';
            statusDiv.className = 'alert alert-info';
            statusDiv.textContent = 'Automation in progress... This may take a few minutes.';
            
            // Show music player
            musicPlayer.style.display = 'block';
            
            // Initialize audio if not already done
            if (!audio) {
                initAudio();
            }
            
            // Set automation running flag
            isAutomationRunning = true;
            
            // Try to play audio
            if (audio) {
                // Create a user interaction context
                const playAudio = () => {
                    console.log('Attempting to play audio on form submission...');
                    audio.play()
                        .then(() => {
                            console.log('Audio playing successfully on form submission');
                            isPlaying = true;
                            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                            
                            // Set up an interval to ensure it keeps playing during automation
                            if (!audioLoopInterval) {
                                audioLoopInterval = setInterval(ensureAudioPlaying, 5000); // Check every 5 seconds
                            }
                            
                            // Remove the click listener after successful playback
                            document.removeEventListener('click', playAudio);
                        })
                        .catch(error => {
                            console.error('Autoplay error on form submission:', error);
                            // Try with a direct path
                            const directPath = '/static/WhatsApp Audio 2025-04-30 at 9.09.29 PM.mpeg';
                            console.log('Trying direct path on form submission:', directPath);
                            audio.src = directPath;
                            audio.load();
                            
                            // Add a click listener to the play button specifically
                            playPauseBtn.addEventListener('click', () => {
                                audio.play()
                                    .then(() => {
                                        console.log('Audio playing with direct path on form submission');
                                        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                                        isPlaying = true;
                                        
                                        // Set up an interval to ensure it keeps playing during automation
                                        if (!audioLoopInterval) {
                                            audioLoopInterval = setInterval(ensureAudioPlaying, 5000); // Check every 5 seconds
                                        }
                                    })
                                    .catch(err => {
                                        console.error('Direct path playback failed on form submission:', err);
                                    });
                            }, { once: true });
                        });
                };
                
                // Try to play immediately
                playAudio();
            }

            // Get form data
            const formData = new FormData(this);
            
            // Send request
            fetch('/start', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                // Hide progress bar
                progressBar.style.display = 'none';
                
                // Update status based on response
                if (data.status === 'success') {
                    statusDiv.className = 'alert alert-success';
                } else if (data.status === 'warning') {
                    statusDiv.className = 'alert alert-warning';
                } else {
                    statusDiv.className = 'alert alert-danger';
                }
                
                statusDiv.textContent = data.message;
                
                // Re-enable form
                submitBtn.disabled = false;
                submitBtn.textContent = 'Start Automation';
                
                // Stop automation running flag
                isAutomationRunning = false;
                
                // Clear the interval when automation is complete
                if (audioLoopInterval) {
                    clearInterval(audioLoopInterval);
                    audioLoopInterval = null;
                }
            })
            .catch(error => {
                // Hide progress bar
                progressBar.style.display = 'none';
                
                // Show error
                statusDiv.className = 'alert alert-danger';
                statusDiv.textContent = 'An error occurred. Please try again.';
                
                // Re-enable form
                submitBtn.disabled = false;
                submitBtn.textContent = 'Start Automation';
                
                // Stop automation running flag
                isAutomationRunning = false;
                
                // Clear the interval when automation is complete
                if (audioLoopInterval) {
                    clearInterval(audioLoopInterval);
                    audioLoopInterval = null;
                }
                
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html> 